{
  "imports": [
    "$import glob",
    "$import os"
  ],
  "model_name": "unet",
  "bundle_root": "$os.getcwd()",
  "output_dir": "$os.path.join(@bundle_root, 'eval')",
  "dataset_dir": "/workspace/Data/Pathology/CoNSeP/Test/Images",
  "num_cpus": 2,
  "batch_size": 1,
  "sw_batch_size": 16,
  "patch_size": 512,
  "out_size": 512,
  "network_def": {
    "_target_": "HoVerNet",
    "adapt_standard_resnet": true,
    "in_channels": 3,
    "out_classes": 5
  },
  "network": "$@network_def.to(@device)",
  "preprocessing": {
    "_target_": "Compose",
    "transforms": [
      {
        "_target_": "LoadImaged",
        "keys": "image",
        "reader": "$monai.data.PILReader",
        "converter": "$lambda x: x.convert('RGB')"
      },
      {
        "_target_": "CastToTyped",
        "keys": "image",
        "dtype": "float32"
      },
      {
        "_target_": "ScaleIntensityRanged",
        "keys": "image",
        "a_min": 0.0,
        "a_max": 255.0,
        "b_min": 0.0,
        "b_max": 1.0,
        "clip": true
      }
    ]
  },
  "data_list": "$[{'image': image} for image in glob.glob(os.path.join(@dataset_dir, '*.png'))]",
  "dataset": {
    "_target_": "Dataset",
    "data": "@data_list",
    "transform": "@preprocessing"
  },
  "dataloader": {
    "_target_": "DataLoader",
    "dataset": "@dataset",
    "batch_size": "@batch_size",
    "shuffle": false,
    "num_workers": "@num_cpus",
    "pin_memory": true
  },
  "inferer": {
    "_target_": "SlidingWindowHoVerNetInferer",
    "roi_size": "@patch_size",
    "sw_batch_size": "@sw_batch_size",
    "overlap": "$1.0 - float(@out_size) / float(@patch_size)",
    "padding_mode": "constant",
    "cval": 0,
    "progress": true,
    "extra_input_padding": "$((@patch_size - @out_size) // 2,) * 4"
  },
  "postprocessing": {
    "_target_": "Compose",
    "transforms": []
  },
  "handlers": [
    {
      "_target_": "CheckpointLoader",
      "load_path": "$os.path.join(@bundle_root, 'models', 'model.pt')",
      "map_location": "@device",
      "load_dict": {
        "model": "@network"
      }
    }
  ],
  "evaluator": {
    "_target_": "SupervisedEvaluator",
    "device": "@device",
    "val_data_loader": "@dataloader",
    "val_handlers": "@handlers",
    "network": "@network",
    "postprocessing": "@postprocessing",
    "inferer": "@inferer",
    "amp": true
  },
  "evaluating": []
}